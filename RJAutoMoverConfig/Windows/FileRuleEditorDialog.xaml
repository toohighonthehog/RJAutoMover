<Window x:Class="RJAutoMoverConfig.Windows.FileRuleEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Edit File Rule"
        Height="700" Width="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#F5F5F5"
        ShowInTaskbar="False">

    <Window.Resources>
        <!-- Resources go here -->
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource HeaderGradient}" Padding="20,15">
            <TextBlock Text="File Rule Editor" FontSize="18" FontWeight="Bold" Foreground="White"/>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">
                <!-- Validation Summary -->
                <Border x:Name="ValidationSummary" Background="#FFF3CD" BorderBrush="#FFC107" BorderThickness="1"
                        Padding="10" Margin="0,0,0,15" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="âš  Validation Errors:" FontWeight="Bold" Foreground="#856404" Margin="0,0,0,5"/>
                        <TextBlock x:Name="ValidationSummaryText" TextWrapping="Wrap" Foreground="#856404" FontSize="11"/>
                    </StackPanel>
                </Border>

                <!-- Rule Name -->
                <TextBlock Text="Rule Name" Style="{StaticResource LabelStyle}"/>
                <TextBox x:Name="RuleNameTextBox" Style="{StaticResource TextBoxStyle}"
                         Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                         MaxLength="32"
                         TextChanged="RuleNameTextBox_TextChanged"/>
                <TextBlock x:Name="RuleNameError" FontSize="10" Foreground="Red" Margin="0,2,0,0" Visibility="Collapsed"/>
                <TextBlock Text="Alphanumeric and spaces only, max 32 characters"
                           FontSize="10" Foreground="#999" Margin="0,2,0,10"/>

                <!-- Source Folder -->
                <TextBlock Text="Source Folder" Style="{StaticResource LabelStyle}"/>
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="SourceFolderTextBox" Grid.Column="0" Style="{StaticResource TextBoxStyle}"
                             Text="{Binding SourceFolder, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0"/>
                    <Button Grid.Column="1" Content="Browse" Padding="10,5" Margin="5,5,5,5"
                            Click="BrowseSourceFolder_Click"/>
                    <Button Grid.Column="2" Content="â–¼" Padding="8,5" Margin="0,5"
                            Click="ShowSourceVariables_Click" ToolTip="Special variables"/>
                </Grid>
                <TextBlock x:Name="SourceFolderStatus" FontSize="10" Margin="0,2,0,10"/>

                <!-- Destination Folder -->
                <TextBlock Text="Destination Folder" Style="{StaticResource LabelStyle}"/>
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="DestinationFolderTextBox" Grid.Column="0" Style="{StaticResource TextBoxStyle}"
                             Text="{Binding DestinationFolder, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0"/>
                    <Button Grid.Column="1" Content="Browse" Padding="10,5" Margin="5,5,5,5"
                            Click="BrowseDestinationFolder_Click"/>
                    <Button Grid.Column="2" Content="â–¼" Padding="8,5" Margin="0,5"
                            Click="ShowDestVariables_Click" ToolTip="Special variables"/>
                </Grid>
                <TextBlock x:Name="DestinationFolderStatus" FontSize="10" Margin="0,2,0,10"/>

                <!-- Extensions -->
                <TextBlock Text="File Extensions" Style="{StaticResource LabelStyle}"/>
                <TextBox x:Name="ExtensionTextBox" Style="{StaticResource TextBoxStyle}"
                         Text="{Binding Extension, UpdateSourceTrigger=PropertyChanged}"
                         TextChanged="ExtensionTextBox_TextChanged"
                         ToolTip="Extensions MUST begin with a dot (.) and contain 1-10 alphanumeric characters.&#x0a;Case-insensitive: rule '.txt' matches '.TXT' files (preserves original case when moving).&#x0a;Files matching a specific extension rule are processed first, then OTHERS rules process remaining files."/>
                <TextBlock x:Name="ExtensionError" FontSize="10" Foreground="Red" Margin="0,2,0,0" Visibility="Collapsed"/>
                <TextBlock FontSize="10" Foreground="#999" Margin="0,2,0,5" TextWrapping="Wrap">
                    <Run Text="Use | to separate multiple extensions (e.g., .pdf|.doc|.txt)"/>
                    <LineBreak/>
                    <Run Text="Use 'OTHERS' to match any file type (requires date filter)"/>
                    <LineBreak/>
                    <Run Text="âš ï¸ All extensions MUST begin with a dot (e.g., '.txt' not 'txt')"/>
                </TextBlock>

                <!-- Scan Interval -->
                <TextBlock Text="Scan Interval (milliseconds)" Style="{StaticResource LabelStyle}"/>
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="ScanIntervalTextBox" Grid.Column="0" Width="100"
                             Text="{Binding ScanIntervalMs, UpdateSourceTrigger=PropertyChanged}"
                             VerticalContentAlignment="Center" Padding="5" Margin="0"
                             TextChanged="ScanIntervalTextBox_TextChanged"/>
                    <Slider x:Name="ScanIntervalSlider" Grid.Column="1"
                            Minimum="5000" Maximum="900000"
                            Value="{Binding ScanIntervalMs, UpdateSourceTrigger=PropertyChanged}"
                            TickFrequency="5000" IsSnapToTickEnabled="True"
                            Margin="15,0" VerticalAlignment="Center"/>
                    <TextBlock x:Name="ScanIntervalLabel" Grid.Column="2"
                               VerticalAlignment="Center" FontSize="11" Foreground="#666"/>
                </Grid>
                <TextBlock x:Name="ScanIntervalError" FontSize="10" Foreground="Red" Margin="0,2,0,0" Visibility="Collapsed"/>
                <TextBlock Text="Range: 5000-900000 ms (5 seconds to 15 minutes)"
                           FontSize="10" Foreground="#999" Margin="0,2,0,10"/>

                <!-- File Exists Action -->
                <TextBlock Text="Action if File Exists in Destination" Style="{StaticResource LabelStyle}"/>
                <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                    <RadioButton x:Name="FileExistsSkipRadio" Content="Skip (leave existing file)"
                                 GroupName="FileExists" Margin="0,0,20,0"
                                 Checked="FileExistsRadio_Checked"
                                 ToolTip="Skips files that already exist in destination. Service tracks skipped files and only logs changes."/>
                    <RadioButton x:Name="FileExistsOverwriteRadio" Content="Overwrite (replace existing)"
                                 GroupName="FileExists"
                                 Checked="FileExistsRadio_Checked"
                                 ToolTip="Replaces existing files in destination with source file."/>
                </StackPanel>
                <TextBlock FontSize="10" Foreground="#999" Margin="0,2,0,10" TextWrapping="Wrap">
                    <Run Text="â„¹ï¸ If multiple rules target the same source folder, the first rule to process a file will move it."/>
                    <LineBreak/>
                    <Run Text="   Other rules will skip that file (already being processed). Rules process concurrently."/>
                </TextBlock>

                <!-- Date Filtering -->
                <TextBlock Text="Date Filtering (Optional)" Style="{StaticResource SectionHeaderStyle}"/>
                <Border Background="#F8F8F8" BorderBrush="#DDDDDD" BorderThickness="1" Padding="15" Margin="0,5,0,10" CornerRadius="4">
                    <StackPanel>
                        <TextBlock FontSize="11" Foreground="#666" Margin="0,0,0,10" TextWrapping="Wrap">
                            Select one date filter type, or choose "None" to process all files regardless of date.
                        </TextBlock>

                        <!-- No Filter Option -->
                        <RadioButton x:Name="NoDateFilterRadio" Content="None - Process all files" GroupName="DateFilter"
                                     Margin="0,5" IsChecked="True" FontWeight="Medium"
                                     Checked="DateFilterRadio_Changed"/>

                        <Separator Margin="0,10" Background="#DDDDDD"/>

                        <!-- Filter Type Selection Grid -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Last Accessed Filter -->
                            <RadioButton x:Name="LastAccessedRadio" Content="Last Accessed Time" GroupName="DateFilter"
                                         Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" FontWeight="Medium"
                                         Margin="0,5" Checked="DateFilterRadio_Changed"
                                         ToolTip="Filters based on when files were last opened/read. Note: Windows may disable access time updates for performance."/>
                            <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="1" Margin="10,5,0,5"
                                        IsEnabled="{Binding IsChecked, ElementName=LastAccessedRadio}">
                                <TextBlock Text="Files" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox x:Name="LastAccessedDirection" Width="100" SelectedIndex="0"
                                          SelectionChanged="DateFilterComboBox_SelectionChanged"
                                          ToolTip="'older than' = files NOT accessed in last X minutes (processes OLD files)&#x0a;'within last' = files accessed in last X minutes (processes RECENT files)">
                                    <ComboBoxItem Content="older than"/>
                                    <ComboBoxItem Content="within last"/>
                                </ComboBox>
                                <TextBox x:Name="LastAccessedMinsTextBox" Width="80" Padding="5" Margin="5,0"
                                         VerticalContentAlignment="Center"
                                         TextChanged="DateFilterTextBox_TextChanged"/>
                                <TextBlock Text="minutes" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Last Modified Filter -->
                            <RadioButton x:Name="LastModifiedRadio" Content="Last Modified Time" GroupName="DateFilter"
                                         Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" FontWeight="Medium"
                                         Margin="0,5" Checked="DateFilterRadio_Changed"
                                         ToolTip="Filters based on when file content was last changed/written."/>
                            <StackPanel Orientation="Horizontal" Grid.Row="1" Grid.Column="1" Margin="10,5,0,5"
                                        IsEnabled="{Binding IsChecked, ElementName=LastModifiedRadio}">
                                <TextBlock Text="Files" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox x:Name="LastModifiedDirection" Width="100" SelectedIndex="0"
                                          SelectionChanged="DateFilterComboBox_SelectionChanged"
                                          ToolTip="'older than' = files NOT modified in last X minutes (processes OLD files)&#x0a;'within last' = files modified in last X minutes (processes RECENT files)">
                                    <ComboBoxItem Content="older than"/>
                                    <ComboBoxItem Content="within last"/>
                                </ComboBox>
                                <TextBox x:Name="LastModifiedMinsTextBox" Width="80" Padding="5" Margin="5,0"
                                         VerticalContentAlignment="Center"
                                         TextChanged="DateFilterTextBox_TextChanged"/>
                                <TextBlock Text="minutes" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- File Created Filter -->
                            <RadioButton x:Name="AgeCreatedRadio" Content="File Created Time" GroupName="DateFilter"
                                         Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" FontWeight="Medium"
                                         Margin="0,5" Checked="DateFilterRadio_Changed"
                                         ToolTip="Filters based on when file was originally created on disk."/>
                            <StackPanel Orientation="Horizontal" Grid.Row="2" Grid.Column="1" Margin="10,5,0,5"
                                        IsEnabled="{Binding IsChecked, ElementName=AgeCreatedRadio}">
                                <TextBlock Text="Files" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox x:Name="AgeCreatedDirection" Width="100" SelectedIndex="0"
                                          SelectionChanged="DateFilterComboBox_SelectionChanged"
                                          ToolTip="'older than' = files created more than X minutes ago (processes OLD files)&#x0a;'within last' = files created within last X minutes (processes RECENT files)">
                                    <ComboBoxItem Content="older than"/>
                                    <ComboBoxItem Content="within last"/>
                                </ComboBox>
                                <TextBox x:Name="AgeCreatedMinsTextBox" Width="80" Padding="5" Margin="5,0"
                                         VerticalContentAlignment="Center"
                                         TextChanged="DateFilterTextBox_TextChanged"/>
                                <TextBlock Text="minutes" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock x:Name="DateFilterError" FontSize="10" Foreground="Red" Margin="0,10,0,0" Visibility="Collapsed"/>

                        <Separator Margin="0,10" Background="#DDDDDD"/>

                        <TextBlock FontSize="10" Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,5">
                            <Run Text="ðŸ’¡ Common values: 60 (1 hr) â€¢ 1440 (1 day) â€¢ 10080 (7 days) â€¢ 43200 (30 days)"/>
                        </TextBlock>

                        <TextBlock FontSize="9" Foreground="#999" TextWrapping="Wrap" FontFamily="Consolas">
                            <Run Text="Format saved to config: TYPE:SIGN:MINUTES (e.g., LA:+43200, LM:-1440, FC:+10080)"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Rule Active -->
                <CheckBox x:Name="IsActiveCheckBox" Content="Rule is Active" FontWeight="Bold" FontSize="13"
                          IsChecked="{Binding IsActive}" Margin="0,10,0,0"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Buttons -->
        <Border Grid.Row="2" Background="White" Padding="15" BorderBrush="#DDDDDD" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Commit" Style="{StaticResource ButtonStyle}"
                        Click="SaveButton_Click" Padding="20,8" MinWidth="100"/>
                <Button Content="Cancel" Style="{StaticResource ButtonStyle}"
                        Click="CancelButton_Click" Padding="20,8" MinWidth="100" Background="#999999"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
